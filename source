-- configurations
getgenv().keybind = Enum.KeyCode.C

getgenv().wall_check = false
getgenv().downed_check = false

getgenv().auto_prediction = true
getgenv().prediction = 0.00 -- leave this if auto predicition is on.

-- script
if getgenv().notifications == nil then
    getgenv().notifications = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/polarsblade/source/main/notifications"))()
end
getgenv().notifications.set_name("source")
getgenv().notifications.set_color("26, 35, 92")
getgenv().notifications.notify("loaded notifications (1 / 3)")

if getgenv().lock_functions == nil then
    getgenv().lock_functions = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/polarsblade/source/main/lockdependencies"))()
end
getgenv().notifications.notify("loaded functions (2 / 3)")

local local_player = game.Players.LocalPlayer
local mouse = local_player:GetMouse()
local user_input_service = game.UserInputService

local locking = false
local target = nil

local highlight = nil
local billboard = nil
if getgenv().input_detection == nil then
    getgenv().input_began_detection = user_input_service.InputBegan:Connect(function(input, ignore)
        if ignore then return end

        if input.KeyCode == getgenv().keybind then
            if not target then
                target = getgenv().lock_functions.get_target(mouse.Hit.Position)
                if target then
                    user_input_service.MouseIconEnabled = false

                    billboard = Instance.new("BillboardGui")
                    billboard.Active = true
                    billboard.AlwaysOnTop = true
                    billboard.ClipsDescendants = true
                    billboard.LightInfluence = 1
                    billboard.Size = UDim2.new(15, 0, 15, 0)
                    billboard.ResetOnSpawn = true
                    billboard.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                    billboard.Parent = target.Character.HumanoidRootPart

                    local image = Instance.new("ImageLabel")
                    image.Image = "http://www.roblox.com/asset/?id=16802101786"
                    image.AnchorPoint = Vector2.new(0.5, 0.5)
                    image.BackgroundColor3 = Color3.new(1, 1, 1)
                    image.BackgroundTransparency = 1
                    image.BorderColor3 = Color3.new(0, 0, 0)
                    image.BorderSizePixel = 0
                    image.Position = UDim2.new(0.5, 0, 0.5, 0)
                    image.ImageColor3 = Color3.fromRGB(26, 35, 92)
                    image.Size = UDim2.new(1, 0, 1, 0)
                    image.Visible = true
                    image.Parent = billboard

                    highlight = Instance.new("Highlight")
                    highlight.Parent = target.Character
                    highlight.FillTransparency = 1
                    highlight.OutlineTransparency = 0
                    highlight.OutlineColor = Color3.fromRGB(26, 35, 92)

                    getgenv().notifications.notify("locked // "..target.Name)

                    image_size_original = image.Size

                    spin = 0.05
                    pcall(function()
                        repeat
                            task.wait()
                            
                            spin += 0.05
                            if spin >= (math.pi * 2) then
                                spin = 0
                            end
                            image.Rotation += spin

                            workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, target.Character.HumanoidRootPart.Position + target.Character.HumanoidRootPart.Velocity / getgenv().prediction)
                        
                            if getgenv().downed_check then
                                if target.Character.BodyEffects["K.O"].Value == true or target.Character.BodyEffects["Dead"].Value == true then
                                    getgenv().notifications.notify("downed // "..target.Name.." |")
                                    break
                                end
                            end
                        until not target
                    end)

                    user_input_service.MouseIconEnabled = true
                else
                    getgenv().notifications.notify("failed to lock on")
                end
            else
                target = nil

                if billboard then
                    billboard:Destroy()
                    billboard = nil
                end

                if highlight then
                    highlight:Destroy()
                    highlight = nil
                end

                getgenv().notifications.notify("lock disabled")
            end
        end
    end)
else
    getgenv().input_began_detection:Disconnect()
    getgenv().input_ended_detection:Disconnect()
    getgenv().notifications.notify("re-run the script")
end

if getgenv().auto_prediction then
    task.spawn(function()
        while task.wait() do
            local pingvalue = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
            local split = string.split(pingvalue,'(')
            local ping = tonumber(split[1])    
            if ping < 30 then
                getgenv().prediction = 7.758
            elseif ping < 40 then
                getgenv().prediction = 7.364
            elseif ping < 50 then
                getgenv().prediction = 7.456 
            elseif ping < 60 then
                getgenv().prediction = 7.217
            elseif ping < 70 then
                getgenv().prediction = 6.972 
            elseif ping < 80 then
                getgenv().prediction = 6.782
            elseif ping < 90 then
                getgenv().prediction = 6.597 
            elseif ping < 100 then
                getgenv().prediction = 3.88
            elseif ping < 110 then
                getgenv().prediction = 6.099
            end
        end
    end)
end

getgenv().notifications.notify("loaded script (3 / 3)")
