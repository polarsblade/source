-- configurations
getgenv().keybind = Enum.KeyCode.C

getgenv().wall_check = false
getgenv().downed_check = false

getgenv().auto_prediction = true
getgenv().prediction = 0.00 -- leave this if auto predicition is on.

-- script
if getgenv().notifications == nil then
    getgenv().notifications = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/polarsblade/source/main/notifications"))()
end
getgenv().notifications.set_name("source")
getgenv().notifications.set_color("26, 35, 92")
getgenv().notifications.notify("loaded notifications (1 / 3)")

if getgenv().lock_functions == nil then
    getgenv().lock_functions = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/polarsblade/source/main/lockdependencies"))()
end
getgenv().notifications.notify("loaded functions (2 / 3)")

local local_player = game.Players.LocalPlayer
local mouse = local_player:GetMouse()
local user_input_service = game.UserInputService

local locking = false
local target = nil

local highlight = nil

if getgenv().input_detection == nil then
    getgenv().input_began_detection = user_input_service.InputBegan:Connect(function(input, ignore)
        if ignore then return end

        if input.KeyCode == getgenv().keybind then
            if not target then
                target = getgenv().lock_functions.get_target(mouse.Hit.Position)
                if target then
                    user_input_service.MouseIconEnabled = false
                    highlight = Instance.new("Highlight")
                    highlight.Parent = target.Character
                    highlight.FillTransparency = 1
                    highlight.OutlineTransparency = 0
                    highlight.OutlineColor = Color3.fromRGB(26, 35, 92)

                    getgenv().notifications.notify("locked | "..target.Name.." |")
                    pcall(function()
                        repeat
                            task.wait()

                            workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, target.Character.UpperTorso.Position + target.Character.UpperTorso.Velocity / getgenv().prediction)
                        until not target
                    end)
                    
                    user_input_service.MouseIconEnabled = true
                else
                    getgenv().notifications.notify("failed to lock on")
                end
            else
                target = nil

                if highlight then
                    highlight:Destroy()
                    highlight = nil
                end
                getgenv().notifications.notify("lock disabled")
            end
        end
    end)
else
    getgenv().input_began_detection:Disconnect()
    getgenv().input_ended_detection:Disconnect()
    getgenv().notifications.notify("re-run the script")
end

if getgenv().auto_prediction then
    task.spawn(function()
        while task.wait() do
            local pingvalue = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
            local split = string.split(pingvalue,'(')
            local ping = tonumber(split[1])    
            if ping < 30 then
                getgenv().prediction = 7.758
            elseif ping < 40 then
                getgenv().prediction = 7.364
            elseif ping < 50 then
                getgenv().prediction = 7.456 
            elseif ping < 60 then
                getgenv().prediction = 7.217
            elseif ping < 70 then
                getgenv().prediction = 6.972 
            elseif ping < 80 then
                getgenv().prediction = 6.782
            elseif ping < 90 then
                getgenv().prediction = 6.597 
            elseif ping < 100 then
                getgenv().prediction = 3.88
            elseif ping < 110 then
                getgenv().prediction = 6.099
            end
        end
    end)
end

getgenv().notifications.notify("loaded script (3 / 3)")
